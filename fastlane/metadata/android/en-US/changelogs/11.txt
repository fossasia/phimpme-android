Major enhancements and bug fixes